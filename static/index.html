<!DOCTYPE html>
<html>
<body>
  <video id="local" autoplay muted playsinline></video>
  <video id="remote" autoplay playsinline></video>

<script>
const pc = new RTCPeerConnection();

// افتح الكاميرا
navigator.mediaDevices.getUserMedia({ video: true })
  .then(stream => {
    document.getElementById("local").srcObject = stream;
    stream.getTracks().forEach(track => pc.addTrack(track, stream));
  });

// استقبل الفيديو المعالج من السيرفر
pc.ontrack = (event) => {
  document.getElementById("remote").srcObject = event.streams[0];
};

// ابعت Offer للسيرفر علشان يبدأ WebRTC
async function start() {
  const offer = await pc.createOffer();
  await pc.setLocalDescription(offer);

  const res = await fetch("/offer", {
    method: "POST",
    body: JSON.stringify({ sdp: offer }),
    headers: { "Content-Type": "application/json" }
  });

  const data = await res.json();
  await pc.setRemoteDescription(data);
}

start();
</script>

</body>
</html>
